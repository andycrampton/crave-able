<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>craVEable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #f8f9f5; margin: 0; height: 100dvh; overflow: hidden; }
        #app { height: 100dvh; display: flex; flex-direction: column; }
        .scroll-area { flex: 1; overflow-y: auto; padding-bottom: 200px; -webkit-overflow-scrolling: touch; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); }
        .brand-green { color: #166534; }
        .bg-brand-green { background-color: #166534; }
        .shimmer { background: linear-gradient(90deg, #f0f4e8 25%, #e2e8d5 50%, #f0f4e8 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body>
    <div id="app">
        <header class="p-6 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-brand-green rounded-xl flex items-center justify-center shadow-lg">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.4 20 4c1 1 2 5 2 10 0 4.4-4.5 6-11 6zM9 21c0-5 2-7 5-7"/></svg>
                </div>
                <h1 class="text-xl font-black brand-green uppercase tracking-tighter">cra<span class="text-lime-500">VE</span>able</h1>
            </div>
        </header>

        <div class="scroll-area">
            <main class="p-4 space-y-4">
                <div class="glass-card p-5 rounded-[2rem] space-y-3 shadow-sm border-2 border-white">
                    <input id="loc-input" type="text" placeholder="Enter UK Town or Postcode..." class="w-full border-2 border-lime-50 px-4 py-3 rounded-xl focus:outline-none focus:border-brand-green">
                    <button onclick="runSearch()" class="w-full bg-brand-green text-white py-4 rounded-xl font-black uppercase text-sm shadow-md active:scale-95 transition-all">Search for Food & Drink</button>
                </div>

                <div id="loader" class="hidden space-y-3">
                    <div class="h-28 w-full rounded-3xl shimmer"></div>
                    <div class="h-28 w-full rounded-3xl shimmer"></div>
                </div>

                <div id="results" class="space-y-4"></div>
            </main>
        </div>

        <footer style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(248, 249, 245, 0.98); padding: 20px 0 calc(25px + env(safe-area-inset-bottom)); display: flex; flex-direction: column; align-items: center; gap: 10px; border-top: 1px solid rgba(0,0,0,0.05); z-index: 100;">
            <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="craveable" data-color="#166534" data-text="Support App" data-font="Lato" data-font-color="#ffffff"></script>
        </footer>
    </div>

    <script>
        const apiKey = "AIzaSyClBK14WwHetfsnl-IZM3zMzg81qbVYtbU";

        async function runSearch() {
            const input = document.getElementById('loc-input').value;
            const resDiv = document.getElementById('results');
            const loader = document.getElementById('loader');
            
            if(!input) return alert("Please enter a location");
            
            resDiv.innerHTML = "";
            loader.classList.remove('hidden');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Find 10 popular pubs, bars, and restaurants in ${input}, UK. 
                                Format each entry exactly like this:
                                Name: [Name]
                                Type: [Type]
                                Address: [Address]
                                Summary: [One sentence description]
                                ---`
                            }]
                        }]
                    })
                });

                const data = await response.json();
                loader.classList.add('hidden');

                if (data.candidates && data.candidates[0].content.parts[0].text) {
                    const rawText = data.candidates[0].content.parts[0].text;
                    const entries = rawText.split('---');

                    entries.forEach(entry => {
                        if (entry.trim().length < 10) return;
                        
                        const name = entry.match(/Name: (.*)/)?.[1] || "Unknown Venue";
                        const type = entry.match(/Type: (.*)/)?.[1] || "Restaurant";
                        const addr = entry.match(/Address: (.*)/)?.[1] || "";
                        const summ = entry.match(/Summary: (.*)/)?.[1] || "";

                        const card = document.createElement('div');
                        card.className = "glass-card p-6 rounded-[2rem] shadow-sm border-2 border-white animate-in fade-in slide-in-from-bottom-4";
                        card.innerHTML = `
                            <h3 class="font-bold brand-green text-lg leading-tight">${name}</h3>
                            <p class="text-[10px] font-black text-lime-600 uppercase mt-1 mb-2 tracking-widest">${type} â€¢ ${addr}</p>
                            <p class="text-xs text-neutral-600 leading-relaxed">${summ}</p>
                        `;
                        resDiv.appendChild(card);
                    });
                } else {
                    resDiv.innerHTML = "<p class='text-center p-10 opacity-50'>No venues found. Try another town.</p>";
                }
            } catch (e) {
                loader.classList.add('hidden');
                resDiv.innerHTML = "<p class='text-center p-10 text-red-500 font-bold'>Connection lost. Please refresh.</p>";
            }
        }
    </script>
</body>
</html>
