<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>craVEable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; background-color: #f8f9f5; margin: 0; height: 100dvh; overflow: hidden; }
        #app { height: 100dvh; display: flex; flex-direction: column; position: relative; }
        .scroll-area { flex: 1; overflow-y: auto; padding-bottom: 220px; -webkit-overflow-scrolling: touch; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); }
        .brand-green { color: #166534; }
        .bg-brand-green { background-color: #166534; }
        .shimmer { background: linear-gradient(90deg, #f0f4e8 25%, #e2e8d5 50%, #f0f4e8 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body>
    <div id="app">
        <header class="p-6 flex items-center justify-between z-50">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-brand-green rounded-xl flex items-center justify-center shadow-lg transform rotate-2">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.4 20 4c1 1 2 5 2 10 0 4.4-4.5 6-11 6zM9 21c0-5 2-7 5-7"/></svg>
                </div>
                <h1 class="text-xl font-black brand-green uppercase tracking-tighter">cra<span class="text-lime-500">VE</span>able</h1>
            </div>
        </header>

        <div class="scroll-area">
            <main id="search-view" class="p-4 space-y-4">
                <div class="flex bg-lime-100/50 p-1 rounded-2xl">
                    <button id="tab-venue" onclick="setMode('venue')" class="flex-1 py-2 text-[10px] font-black uppercase rounded-xl bg-white text-brand-green shadow-sm">Location</button>
                    <button id="tab-dish" onclick="setMode('dish')" class="flex-1 py-2 text-[10px] font-black uppercase rounded-xl text-lime-800/60">Dish Finder</button>
                </div>

                <div id="venue-inputs" class="glass-card p-5 rounded-[2rem] space-y-3 shadow-sm border-2 border-white">
                    <input id="venue-loc-input" type="text" placeholder="e.g. Leeds, LS1..." class="w-full border-2 border-lime-50 px-4 py-3 rounded-xl focus:outline-none">
                    <button onclick="performVenueSearch()" class="w-full bg-brand-green text-white py-4 rounded-xl font-black uppercase text-sm shadow-md active:scale-95 transition-all">Find Vegan Spots</button>
                </div>

                <div id="dish-inputs" class="hidden glass-card p-5 rounded-[2rem] space-y-3 shadow-sm border-2 border-white">
                    <input id="dish-query" type="text" placeholder="e.g. Vegan Burger..." class="w-full border-2 border-lime-50 px-4 py-3 rounded-xl focus:outline-none">
                    <input id="dish-loc" type="text" placeholder="Where?" class="w-full border-2 border-lime-50 px-4 py-3 rounded-xl focus:outline-none">
                    <button onclick="performDishSearch()" class="w-full bg-brand-green text-white py-4 rounded-xl font-black uppercase text-sm shadow-md">Find Dish</button>
                </div>

                <div id="loader" class="hidden space-y-3"><div class="h-28 w-full rounded-[2.5rem] shimmer"></div></div>
                <div id="results-list" class="space-y-4"></div>
            </main>
        </div>

        <footer style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(248, 249, 245, 0.98); backdrop-filter: blur(15px); padding: 20px 0 calc(25px + env(safe-area-inset-bottom)); display: flex; flex-direction: column; align-items: center; gap: 10px; border-top: 1px solid rgba(0,0,0,0.05); z-index: 100;">
            <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="craveable" data-color="#166534" data-text="Support App" data-font="Lato" data-font-color="#ffffff"></script>
        </footer>
    </div>

    <script>
        const apiKey = "AIzaSyClBK14WwHetfsnl-IZM3zMzg81qbVYtbU";

        function setMode(mode) {
            document.getElementById('venue-inputs').classList.toggle('hidden', mode !== 'venue');
            document.getElementById('dish-inputs').classList.toggle('hidden', mode !== 'dish');
            document.getElementById('tab-venue').className = mode === 'venue' ? 'flex-1 py-2 text-[10px] font-black uppercase rounded-xl bg-white text-brand-green shadow-sm' : 'flex-1 py-2 text-[10px] font-black uppercase rounded-xl text-lime-800/60';
            document.getElementById('tab-dish').className = mode === 'dish' ? 'flex-1 py-2 text-[10px] font-black uppercase rounded-xl bg-white text-brand-green shadow-sm' : 'flex-1 py-2 text-[10px] font-black uppercase rounded-xl text-lime-800/60';
        }

        async function executeSearch(queryText) {
            const list = document.getElementById('results-list');
            const loader = document.getElementById('loader');
            list.innerHTML = ''; 
            loader.classList.remove('hidden');
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: [{ 
                            parts: [{ text: `Act as a vegan food guide. Search for: ${queryText}. Provide 10 real UK results. For each result, list the Name, the Type of venue, the Address, and a short 1-sentence description. Separate each venue with the text marker: [SPLIT]` }] 
                        }] 
                    })
                });
                
                const data = await response.json();
                loader.classList.add('hidden');

                if (data.candidates && data.candidates[0].content.parts[0].text) {
                    const rawText = data.candidates[0].content.parts[0].text;
                    const items = rawText.split('[SPLIT]');

                    items.forEach(item => {
                        if (item.trim().length < 10) return;
                        const card = document.createElement('div');
                        card.className = "glass-card p-6 rounded-[2.5rem] shadow-sm border-2 border-white mb-2 animate-in fade-in slide-in-from-bottom-4";
                        card.innerHTML = `<div class="text-xs text-neutral-800 leading-relaxed font-medium whitespace-pre-line">${item.trim().replace(/^\*/gm, '')}</div>`;
                        list.appendChild(card);
                    });
                } else {
                    list.innerHTML = "<p class='text-center p-10 opacity-40 text-xs'>No results found. Please check your spelling.</p>";
                }
            } catch (e) {
                loader.classList.add('hidden');
                list.innerHTML = "<p class='text-center p-10 text-red-700 text-xs font-bold'>Connection lost. Try again.</p>";
            }
        }

        function performVenueSearch() { executeSearch("Vegan-friendly pubs and restaurants in " + document.getElementById('venue-loc-input').value); }
        function performDishSearch() { executeSearch("Best places to get " + document.getElementById('dish-query').value + " in " + document.getElementById('dish-loc').value); }
    </script>
</body>
</html>
